{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0


<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Generador de enlaces de afiliado Amazon</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body { margin: 0; background: #0b1020; color: #e6e8f0; }
    .wrap { max-width: 780px; margin: 0 auto; padding: 24px; }
    .card { background: #121a34; border: 1px solid #263055; border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    h1 { margin: 0 0 8px; font-size: 24px; }
    p { color: #b8c0dd; }
    label { display:block; margin: 16px 0 8px; font-weight: 600; }
    input[type="text"] { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid #33406d; background: #0c1430; color: #e6e8f0; outline: none; }
    input[type="text"]::placeholder { color: #90a0d0; }
    .btns { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; align-items: center; }
    button, a.btn { padding: 10px 14px; border: 1px solid #3a4a84; background:#1b2550; color:#e6e8f0; border-radius: 12px; cursor:pointer; text-decoration:none; display:inline-block; }
    button:hover, a.btn:hover { background:#223066; }
    .out { margin-top: 18px; padding: 14px; background:#0c1430; border:1px dashed #3a4a84; border-radius: 12px; word-break: break-all; }
    small.muted { color:#93a2cf }
    .ok { color: #8ef0b1; font-weight: 600; }
    .warn { color: #ffd27f; font-weight: 600; }
    .err { color: #ff8e8e; font-weight: 600; }
    .foot { margin-top: 18px; font-size: 13px; color:#93a2cf }
    a { color:#9ec2ff; }
    .disclosure { margin-top: 10px; font-size: 13px; color:#b8c0dd }
    code.k { background:#0c1430; border:1px solid #33406d; padding:2px 6px; border-radius:8px }
    .toggle { display:block; margin-top: 4px; font-size: 14px; color:#b8c0dd; }
    .hidden { display:none !important; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Generador de enlaces de afiliado Amazon</h1>
      <p>Pega cualquier URL de Amazon y obtén tu enlace con <code class="k">tag=</code> (oculto en la UI) y <code class="k">ascsubtag</code> (opcional). Puedes abrir o copiar sin mostrar la URL.</p>

      <label for="in">URL de Amazon</label>
      <input id="in" type="text" placeholder="Ej.: https://www.amazon.es/dp/B0C1234567?ref_=..." />

      <label for="subtag">Subtag (opcional)</label>
      <input id="subtag" type="text" placeholder="p.ej. instagram-ago25" />
      <small class="muted">Se añade como <code class="k">ascsubtag</code> para tu tracking.</small>

      <div class="btns">
        <button id="convert">Convertir</button>
        <a id="go" href="#" target="_blank" rel="noopener" class="btn hidden">Abrir en Amazon</a>
        <button id="copy" title="Copiar resultado">Copiar</button>
        <button id="clear">Limpiar</button>
        <label class="toggle">
          <input id="showLink" type="checkbox"> Mostrar enlace visible
        </label>
      </div>

      <div id="status" class="foot"></div>
      <div id="out" class="out" contenteditable="false"></div>

      <div class="foot">
        <strong>Nota:</strong> Los enlaces acortados <code class="k">amzn.to</code> no pueden expandirse aquí (limitación del navegador). Pega la URL completa del producto.
      </div>

      <div class="disclosure">
        <strong>Disclosure:</strong>
        <div>ES: <em>“Como afiliado de Amazon, gano con compras que cumplen los requisitos.”</em></div>
        <div>EN: <em>“As an Amazon Associate I earn from qualifying purchases.”</em></div>
      </div>
    </div>
  </div>

<script>
"use strict";

/* ============== TUS TAGS (no se muestran en la UI) ============== */
const DEFAULT_TAG = "keytrading-21"; // ← tu tag principal (.es suele acabar en -21)
const TAGS_BY_DOMAIN = {
  "amazon.es": "keytrading-21",
  "www.amazon.es": "keytrading-21",
  // "amazon.com": "TU_TAG_US",      "www.amazon.com": "TU_TAG_US",
  // "amazon.co.uk": "TU_TAG_UK",    "www.amazon.co.uk": "TU_TAG_UK",
  // "amazon.de": "TU_TAG_DE",       "www.amazon.de": "TU_TAG_DE",
  // "amazon.fr": "TU_TAG_FR",       "www.amazon.fr": "TU_TAG_FR",
  // "amazon.it": "TU_TAG_IT",       "www.amazon.it": "TU_TAG_IT",
};

/* ============== QUITAMOS TRACKING BASURA, CONSERVAMOS VARIANTES/IDIOMA ============== */
const DROP_EXACT = [
  "ref", "ref_", "qid", "sr", "crid",
  "linkCode", "linkId", "camp", "creative", "creativeASIN",
  "aaxitk", "sp_csd", "tag", "ascsubtag", "content-id"
];
const DROP_PREFIX = ["pf_rd_", "pd_rd_"];

/* ============== UTILIDADES ============== */
function normalizeAmazonHostname(hostname) {
  let host = hostname.replace(/^m\./i, "").replace(/^smile\./i, "");
  if (!/^www\./i.test(host)) host = "www." + host;
  return host;
}
function domainTagFor(hostname, fallbackTag) {
  const key = hostname.replace(/^www\./i, "");
  return TAGS_BY_DOMAIN[key] || fallbackTag || DEFAULT_TAG;
}

/* ============== NÚCLEO: LIMPIAR + ETIQUETAR ============== */
function cleanAndTag(u, affiliateTag, subtag) {
  u.hostname = normalizeAmazonHostname(u.hostname);
  u.protocol = "https:";

  for (const key of Array.from(u.searchParams.keys())) {
    if (DROP_EXACT.includes(key)) u.searchParams.delete(key);
    if (DROP_PREFIX.some(p => key.startsWith(p))) u.searchParams.delete(key);
  }

  u.searchParams.set("tag", affiliateTag);
  if (subtag) u.searchParams.set("ascsubtag", subtag);

  return u.toString();
}

function convertRaw(raw, fallbackTag, subtag) {
  if (!raw) throw new Error("Pega una URL de Amazon.");
  let s = raw.trim();
  if (!/^https?:\/\//i.test(s)) s = "https://" + s;

  let u;
  try { u = new URL(s); }
  catch { throw new Error("La URL no es válida."); }

  const host = u.hostname.toLowerCase();
  if (host === "amzn.to") throw new Error("Es un link acortado (amzn.to). Pega la URL completa del producto.");
  if (!/amazon\./i.test(host)) throw new Error("Esto no parece un enlace de Amazon.");

  const affiliateTag = domainTagFor(host, fallbackTag);
  return cleanAndTag(u, affiliateTag, subtag || "");
}

/* ============== UI ============== */
document.addEventListener("DOMContentLoaded", () => {
  const $in = document.getElementById("in");
  const $subtag = document.getElementById("subtag");
  const $out = document.getElementById("out");
  const $status = document.getElementById("status");
  const $go = document.getElementById("go");
  const $showLink = document.getElementById("showLink");

  let lastUrl = ""; // último enlace generado (aunque no se muestre)

  function setStatus(html) { $status.innerHTML = html; }

  function updateVisibleLink() {
    if ($showLink.checked && lastUrl) {
      $out.textContent = lastUrl;
      $out.classList.remove("hidden");
    } else {
      $out.textContent = "";
      $out.classList.remove("hidden");
    }
  }

  function doConvert() {
    setStatus("");
    try {
      const res = convertRaw($in.value, DEFAULT_TAG, $subtag.value);
      lastUrl = res;
      $go.href = res;
      $go.classList.remove("hidden");
      updateVisibleLink();
      setStatus('<span class="ok">✓ Enlace preparado.</span>');
    } catch (e) {
      console.error(e);
      lastUrl = "";
      $go.href = "#";
      $go.classList.add("hidden");
      $out.textContent = "";
      setStatus('<span class="err">⚠ ' + e.message + '</span>');
    }
  }

  document.getElementById("convert").addEventListener("click", doConvert);

  document.getElementById("copy").addEventListener("click", async () => {
    if (!lastUrl) return setStatus('<span class="warn">Nada para copiar todavía.</span>');
    try {
      await navigator.clipboard.writeText(lastUrl);
      setStatus('<span class="ok">Copiado al portapapeles.</span>');
    } catch {
      setStatus('<span class="warn">No se pudo copiar automáticamente. Copia manualmente.</span>');
    }
  });

  document.getElementById("clear").addEventListener("click", () => {
    $in.value = "";
    $subtag.value = "";
    lastUrl = "";
    $go.href = "#";
    $go.classList.add("hidden");
    $out.textContent = "";
    setStatus("");
  });

  $showLink.addEventListener("change", updateVisibleLink);

  // Enter para convertir
  [$in, $subtag].forEach(el => el.addEventListener("keydown", e => { if (e.key === "Enter") doConvert(); }));
});
</script>
</body>
</html>




